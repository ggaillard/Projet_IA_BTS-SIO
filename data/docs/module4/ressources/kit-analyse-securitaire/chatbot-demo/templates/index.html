<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot P√©dagogique - Deep Learning Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- üö® VULN√âRABILIT√â: Informations sensibles dans les commentaires HTML -->
    <!-- 
    Configuration serveur:
    - API Key: sk-abc123def456ghi789jkl012mno345pqr678stu901vwx234yzab567cde890fgh
    - Database: chatbot.db 
    - Server: chatbot-prod-01.internal.edu
    - Admin panel: /admin (no auth required)
    -->
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ Assistant IA pour le Deep Learning</h1>
            <p class="subtitle">Votre compagnon p√©dagogique pour apprendre l'intelligence artificielle</p>
            
            <!-- üö® VULN√âRABILIT√â: Informations de debug visibles -->
            <div class="debug-info" style="font-size: 10px; color: #666; margin-top: 10px;">
                Debug: Server=chatbot-prod-01 | DB=chatbot.db | Version=1.0-dev | API=Mistral-tiny
            </div>
        </header>

        <div class="chat-container">
            <div id="chat-messages" class="chat-messages">
                <div class="message bot-message">
                    <div class="message-content">
                        <strong>ü§ñ Assistant IA:</strong> Bonjour ! Je suis votre assistant p√©dagogique sp√©cialis√© en Deep Learning. 
                        Posez-moi vos questions sur les r√©seaux de neurones, CNN, RNN, et bien plus !
                    </div>
                    <div class="message-time">Syst√®me initialis√©</div>
                </div>
            </div>

            <div class="chat-input-container">
                <form id="chat-form">
                    <!-- üö® VULN√âRABILIT√â: Collecte d'email sans justification claire -->
                    <div class="user-info">
                        <input type="email" id="user-email" placeholder="Votre email (obligatoire)" required>
                        <small>üìß Pour personnaliser vos r√©ponses et sauvegarder l'historique</small>
                    </div>
                    
                    <div class="input-group">
                        <textarea id="user-message" placeholder="Tapez votre question sur le Deep Learning..." 
                                rows="3" maxlength="2000"></textarea>
                        <button type="submit" id="send-btn">
                            <span>Envoyer</span>
                            <span class="loading" style="display: none;">‚è≥</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- üö® VULN√âRABILIT√â: Liens vers des sections sensibles -->
        <footer>
            <div class="footer-links">
                <a href="/admin">üë®‚Äçüíº Administration</a> |
                <a href="/health">üîç √âtat du syst√®me</a> |
                <a href="/logs">üìã Logs syst√®me</a>
            </div>
            
            <!-- üö® VULN√âRABILIT√â: Informations syst√®me expos√©es -->
            <div class="system-info">
                <small>
                    Serveur: chatbot-prod-01.internal.edu | 
                    Base de donn√©es: chatbot.db | 
                    API: Mistral AI | 
                    Version: 1.0-dev-unsafe
                </small>
            </div>
        </footer>
    </div>

    <script>
        // üö® VULN√âRABILIT√â: Configuration sensible c√¥t√© client
        const CONFIG = {
            apiKey: 'sk-abc123def456ghi789jkl012mno345pqr678stu901vwx234yzab567cde890fgh',
            serverEndpoint: '/chat',
            adminPanel: '/admin',
            debugMode: true,
            database: 'chatbot.db'
        };

        const chatForm = document.getElementById('chat-form');
        const chatMessages = document.getElementById('chat-messages');
        const userMessageInput = document.getElementById('user-message');
        const userEmailInput = document.getElementById('user-email');
        const sendBtn = document.getElementById('send-btn');

        // üö® VULN√âRABILIT√â: Pas de validation c√¥t√© client
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userMessage = userMessageInput.value.trim();
            const userEmail = userEmailInput.value.trim();
            
            if (!userMessage) return;

            // Afficher le message utilisateur
            addMessage(userMessage, 'user', userEmail);
            
            // Vider l'input et montrer le loading
            userMessageInput.value = '';
            showLoading(true);

            try {
                // üö® VULN√âRABILIT√â: Donn√©es sensibles envoy√©es sans chiffrement
                const requestData = {
                    message: userMessage,
                    email: userEmail,
                    timestamp: new Date().toISOString(),
                    browser: navigator.userAgent,
                    url: window.location.href,
                    sessionId: generateSessionId()
                };

                console.log('Envoi des donn√©es:', requestData); // üö® Logging c√¥t√© client

                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();

                if (response.ok) {
                    // Afficher la r√©ponse de l'IA
                    addMessage(data.response, 'bot');
                    
                    // üö® VULN√âRABILIT√â: Affichage d'informations de debug
                    if (data.debug_info && CONFIG.debugMode) {
                        console.log('Debug info re√ßue:', data.debug_info);
                        addDebugInfo(data.debug_info);
                    }
                } else {
                    // üö® VULN√âRABILIT√â: Affichage complet des erreurs
                    addMessage(`‚ùå Erreur: ${JSON.stringify(data.error, null, 2)}`, 'error');
                    console.error('Erreur compl√®te:', data);
                }
            } catch (error) {
                // üö® VULN√âRABILIT√â: Exposition d'erreurs techniques
                addMessage(`‚ùå Erreur de connexion: ${error.message}`, 'error');
                console.error('Erreur r√©seau:', error);
            } finally {
                showLoading(false);
            }
        });

        function addMessage(content, type, email = '') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            
            const now = new Date().toLocaleTimeString();
            const sender = type === 'user' ? `üë§ ${email}` : 'ü§ñ Assistant IA';
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <strong>${sender}:</strong> ${content}
                </div>
                <div class="message-time">${now}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // üö® VULN√âRABILIT√â: Fonction d'affichage des informations de debug
        function addDebugInfo(debugInfo) {
            const debugDiv = document.createElement('div');
            debugDiv.className = 'debug-message';
            debugDiv.innerHTML = `
                <details>
                    <summary>üîç Informations de debug (ne pas partager!)</summary>
                    <pre>${JSON.stringify(debugInfo, null, 2)}</pre>
                </details>
            `;
            chatMessages.appendChild(debugDiv);
        }

        function showLoading(show) {
            const sendSpan = sendBtn.querySelector('span:not(.loading)');
            const loadingSpan = sendBtn.querySelector('.loading');
            
            if (show) {
                sendSpan.style.display = 'none';
                loadingSpan.style.display = 'inline';
                sendBtn.disabled = true;
            } else {
                sendSpan.style.display = 'inline';
                loadingSpan.style.display = 'none';
                sendBtn.disabled = false;
            }
        }

        // üö® VULN√âRABILIT√â: G√©n√©ration d'ID de session pr√©visible
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
        }

        // üö® VULN√âRABILIT√â: Auto-remplissage d'email pour les tests
        document.addEventListener('DOMContentLoaded', () => {
            // Auto-remplir avec un email de test pour faciliter les tests
            if (CONFIG.debugMode) {
                userEmailInput.value = 'test.student@universite.fr';
            }
        });

        // üö® VULN√âRABILIT√â: Raccourcis clavier exposant des fonctions admin
        document.addEventListener('keydown', (e) => {
            // Ctrl+Shift+A = Acc√®s admin direct
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                window.open('/admin', '_blank');
            }
            
            // Ctrl+Shift+L = Affichage des logs
            if (e.ctrlKey && e.shiftKey && e.key === 'L') {
                window.open('/logs', '_blank');
            }
            
            // Ctrl+Shift+H = Health check
            if (e.ctrlKey && e.shiftKey && e.key === 'H') {
                window.open('/health', '_blank');
            }
        });
    </script>
</body>
</html>